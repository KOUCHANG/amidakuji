#!/bin/bash

# pre-commit hook: ã‚³ãƒŸãƒƒãƒˆå‰ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’è‡ªå‹•æ›´æ–°

# æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆæƒ…å ±ã‚’å–å¾—ï¼ˆå‰å›ã®ã‚³ãƒŸãƒƒãƒˆï¼‰
COMMIT_HASH=$(git rev-parse --short HEAD 2>/dev/null || echo "initial")
COMMIT_DATE=$(date "+%Y-%m-%d %H:%M:%S %z")
VERSION=$(date +"%Y.%m.%d-%H%M")

# script.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°
if [ -f "script.js" ]; then
    sed -i.bak "s|// Version: .*|// Version: ${VERSION}|" script.js
    sed -i.bak "s|// Build Date: .*|// Build Date: ${COMMIT_DATE}|" script.js
    sed -i.bak "s|// Commit: .*|// Commit: ${COMMIT_HASH}|" script.js
    rm -f script.js.bak
    
    # æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚¨ãƒªã‚¢ã«è¿½åŠ 
    git add script.js
    
    echo "âœ… Version updated: ${VERSION}"
    echo "ğŸ“¦ Commit: ${COMMIT_HASH}"
    echo "ğŸ“… Date: ${COMMIT_DATE}"
fi

exit 0
